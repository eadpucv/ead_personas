<% content_for :sidebar do %>

<% end %>

<% content_for :content do %>
	<div id="listaCorreo">
	  
	</div>
	
	<h2>BÃºsqueda de Personas</h2>
	<form class="form-inline"> 
		<input type="text" id="txt" name="txt" class="input-large" size="30"/>
		<label class="radio">
			<input type="radio" name="search_type" id="search_type_apellido" value="apellidos">Apellido
		</label>
		<label class="radio">
			<input type="radio" name="search_type" id="search_type_nombre" value="nombres"> Nombre
		</label>
		<label class="radio">
			<input type="radio" name="search_type" id="search_type_usuario" value="usuario"> Usuario
		</label>
		<label class="radio">
			<input type="radio" name="search_type" id="search_type_mail" value="mail"> Mail
		</label>
		<img id="spinner" src="/images/ajax-loader.gif" style="display:none;">
	</form><br />

	
	<%= observe_field 'search_type_mail',
      		:url => { :action => :live_search },
      		:frequency => 0.5,
      		:update => :resultado,
                :loading => "Element.show('spinner')",
                :complete => "Element.hide('spinner')",
      		:with => "Form.serializeElements($('txt', 'search_type_apellido', 'search_type_nombre', 'search_type_usuario', 'search_type_mail'))" 
	%>
	<%= observe_field 'search_type_usuario',
      		:url => { :action => :live_search },
      		:frequency => 0.5,
      		:update => :resultado,
                :loading => "Element.show('spinner')",
                :complete => "Element.hide('spinner')",
      		:with => "Form.serializeElements($('txt', 'search_type_apellido', 'search_type_nombre', 'search_type_usuario', 'search_type_mail'))" 
	%>
	<%= observe_field 'search_type_nombre',
      		:url => { :action => :live_search },
      		:frequency => 0.5,
      		:update => :resultado,
                :loading => "Element.show('spinner')",
                :complete => "Element.hide('spinner')",
      		:with => "Form.serializeElements($('txt', 'search_type_apellido', 'search_type_nombre', 'search_type_usuario', 'search_type_mail'))" 
	%>
	<%= observe_field 'search_type_apellido',
      		:url => { :action => :live_search },
      		:frequency => 0.5,
      		:update => :resultado,
                :loading => "Element.show('spinner')",
                :complete => "Element.hide('spinner')",
      		:with => "Form.serializeElements($('txt', 'search_type_apellido', 'search_type_nombre', 'search_type_usuario', 'search_type_mail'))" 
	%>

	<%= observe_field :txt, 
      		:url => { :action => :live_search },
		:frequency => 0.5,
      		:update => :resultado,
                :loading => "Element.show('spinner')",
                :complete => "Element.hide('spinner')",
      		:with => "Form.serializeElements($('txt', 'search_type_apellido', 'search_type_nombre', 'search_type_usuario', 'search_type_mail'))" 
	%>
	<form action="lotes" id="lotes">

		<div id="formChangeType" style="display:none;">

			<div style="float:left;" id="cambiaTipoConfirm"></div>			
			<div style="float:right;"><a href="javascript:formChangeType('n')">[cerrar]</a></div>

			<table class="table"><tr>
				<td><input type="radio" name="t" value="a" checked> Alumno</input></td>
				<td><input type="radio" name="t" value="p"> Profesor</input></td>
				<td><input type="radio" name="t" value="e"> Ex-Alumno</input></td>
				<td><input type="radio" name="t" value="f"> Amigo</input></td>
				<td><input type="radio" name="t" value="o"> Otro</input></td>
				<td><input id="btn_lista" onclick="new Ajax.Updater('cambiaTipoConfirm','/usuarios/changeUserType', {asynchronous:true, evalScripts:true, parameters:Form.serialize(this.form)});" type="button" value="Cambiar Tipo" /></td>
			</tr></table>		
		</div>

	<div id="tmp"></div>
	<div id="form_buttons">
		<input class="btn" id="btn_block" onclick="confirmBlock()" type="button" value="Bloquear" />
		<input class="btn" id="btn_lista" onclick="new Ajax.Updater('listaCorreo','/usuarios/makeMailList', {asynchronous:true, evalScripts:true, parameters:Form.serialize(this.form)});" type="button" value="Lista de Correo" />
		<input class="btn" id="btn_block" onclick="formChangeType('ver')" type="button" value="Cambiar Tipo" />
	</div>

	<table class="table">
	<thead>
		<tr>
	      	<th class="sortable-text">Usuario</th>
			<th class="sortable-text">Nombre</th>
      		<th class="sortable-text">Apellido</th>      			
      		<th class="sortable-text">Mail</th>
			<th class="sortable-text">Tipo</th>
			<th class="sortable-text"></th>
			<th class="sortable-text"></th>	
		</tr>
	</thead>
	<tbody id="resultado">
		<% for user in @usuarios %>
			<% @login_usuario = Usuario.find_by_sql("SELECT * FROM casserver_st WHERE (username = '#{user.usuario}') ORDER BY id DESC LIMIT 1 ") %>
				<tr id="u_<%= user.id %>">
				<td class="username" ><a class="edit" href="/usuarios/edit/<%= user.id %>"><%= user.usuario %></a> <div id="not<%= user.id %>"></div></td>
				<td class="nombre"><%= user.nombre %></td>
				<td class="apellido"><%= user.apellido %></td>
				<td class="mail"><%= user.mail %></td>
				<td class="tipo"> <div id="tipo_u_<%= user.id %>"><% if user.tipo == 'a'%> Alumno <% end %> <% if user.tipo == 'e'%> Exalumno <% end %> <% if user.tipo == 'p'%> Profesor <% end %> <% if user.tipo == 'n'%> NULL <% end %> <% if user.tipo == 'f'%> Amigo <% end %><% if user.tipo == 'o'%> Otro <% end %></div></td>

				<td class="opciones"><a href'#' onclick='if (confirm("Realmente desea bloquear a este usuario?")) new Ajax.Updater({success:"not<%= user.id %>"}, "/usuarios/block/<%= user.id %>", {asynchronous:true, evalScripts:true}); return false;' class="toogle-btn"><i class="icon-minus-sign"></i><img src='../../images/minus-small-circle.png'></a></td>
				<td class="opciones">
					<% if user.admin == "si" %>		
						<b id='llave_<%= user.id %>'><a href'#' onclick='if (confirm("Realmente desea que el usuario <%= user.nombre %> <%= user.apellido %> ya no sea Administrador?")) new Ajax.Updater({success:"llave_<%= user.id %>"}, "/usuarios/userIsAdmin/<%= user.id %>?accion=n", {asynchronous:true, evalScripts:true}); return false;'><img src='../../images/key.png'></a> <i class="icon-user"></i></b>
					<% else %>
						<b id='llave_<%= user.id %>'><a href'#' onclick='if (confirm("Realmente desea que el usuario <%= user.nombre %> <%= user.apellido %> sea Administrador de Personas?")) new Ajax.Updater({success:"llave_<%= user.id %>"}, "/usuarios/userIsAdmin/<%= user.id %>?accion=y", {asynchronous:true, evalScripts:true}); return false;'><img src='../../images/key_gris.png'></a></b>				
					<% end %>
				</td>
				
				<td><input type="checkbox" name="por_lote[]" id="checkbox_<%= user.id %>" value="<%= user.id %>"></td>
			</tr>
		<% end %>
	</tbody>
	</form>
	</table>
	<% will_paginate @usuarios %>
	
	<div id="form_buttons">
		<input id="btn_block" onclick="confirmBlock()" type="button" value="Bloquear" class="btn"/>
		<input class="btn"id="btn_lista" onclick="new Ajax.Updater('listaCorreo','/usuarios/makeMailList', {asynchronous:true, evalScripts:true, parameters:Form.serialize(this.form)});" type="button" value="Lista de Correo" />
		<input class="btn" id="btn_block" onclick="formChangeType('ver')" type="button" value="Cambiar Tipo" />
	</div>





	
<% end %>
